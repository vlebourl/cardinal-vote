<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>{{ vote.title }} - Public Vote</title>
    <meta name="description" content="Participate in the vote: {{ vote.title }}. Rate each option according to your preferences.">
    <meta name="theme-color" content="#2D5820">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/public_vote.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üó≥Ô∏è</text></svg>">

    <!-- CAPTCHA Scripts (loaded conditionally based on backend configuration) -->
    <script id="captcha-config" type="application/json">
        {
            "backend": "mock",
            "site_key": ""
        }
    </script>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="screen active" role="main" aria-labelledby="vote-title">
            <div class="vote-header">
                <h1 id="vote-title">{{ vote.title }}</h1>
                {% if vote.description %}
                <p class="vote-description">{{ vote.description }}</p>
                {% endif %}
            </div>

            <div class="welcome-content">
                <div id="vote-info" class="vote-info">
                    <div class="info-item">
                        <span class="info-label">Options to rate:</span>
                        <span class="info-value" id="total-options">{{ vote.options|length }}</span>
                    </div>
                    {% if vote.ends_at %}
                    <div class="info-item">
                        <span class="info-label">Vote ends:</span>
                        <span class="info-value">{{ vote.ends_at.strftime('%d/%m/%Y √† %H:%M') }}</span>
                    </div>
                    {% endif %}
                </div>

                <div class="voting-instructions">
                    <p>Rate each option on a scale from -2 to +2:</p>
                    <div class="scale-explanation" role="table" aria-label="√âchelle de notation">
                        <div class="scale-item" role="row">
                            <span class="scale-value negative-strong" role="cell">-2</span>
                            <span class="scale-label" role="cell">Strongly rejected</span>
                        </div>
                        <div class="scale-item" role="row">
                            <span class="scale-value negative" role="cell">-1</span>
                            <span class="scale-label" role="cell">Rejected</span>
                        </div>
                        <div class="scale-item" role="row">
                            <span class="scale-value neutral" role="cell">0</span>
                            <span class="scale-label" role="cell">Neutral</span>
                        </div>
                        <div class="scale-item" role="row">
                            <span class="scale-value positive" role="cell">+1</span>
                            <span class="scale-label" role="cell">Accepted</span>
                        </div>
                        <div class="scale-item" role="row">
                            <span class="scale-value positive-strong" role="cell">+2</span>
                            <span class="scale-label" role="cell">Strongly accepted</span>
                        </div>
                    </div>
                </div>

                <form id="voter-form" novalidate>
                    <div class="voter-fields">
                        <div class="field-group">
                            <label for="voter-first-name" class="field-label">First Name *</label>
                            <input type="text"
                                   id="voter-first-name"
                                   name="voter-first-name"
                                   placeholder="Your first name"
                                   required
                                   autocomplete="given-name"
                                   maxlength="50"
                                   aria-describedby="first-name-help">
                            <div id="first-name-help" class="field-help">Your first name (required)</div>
                        </div>
                        <div class="field-group">
                            <label for="voter-last-name" class="field-label">Last Name *</label>
                            <input type="text"
                                   id="voter-last-name"
                                   name="voter-last-name"
                                   placeholder="Your last name"
                                   required
                                   autocomplete="family-name"
                                   maxlength="50"
                                   aria-describedby="last-name-help">
                            <div id="last-name-help" class="field-help">Your last name (required)</div>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">
                        Start Voting
                    </button>
                </form>
            </div>
        </div>

        <!-- Voting Screen -->
        <div id="voting-screen" class="screen" role="main" aria-labelledby="voting-title">
            <div class="progress-container">
                <div class="progress-bar" role="progressbar" aria-valuenow="1" aria-valuemin="1" aria-valuemax="{{ vote.options|length }}" aria-labelledby="progress-text">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <span class="progress-text" id="progress-text">Option 1 of {{ vote.options|length }}</span>
            </div>

            <div class="voting-content">
                <h2 id="voting-title" class="sr-only">Vote for {{ vote.title }}</h2>

                <!-- Current Option Display -->
                <div class="option-container" id="option-container">
                    <!-- Dynamic content will be inserted here -->
                </div>

                <!-- Rating Selection -->
                <div class="rating-container" role="radiogroup" aria-labelledby="rating-prompt" aria-required="true">
                    <p class="rating-prompt" id="rating-prompt">Your rating:</p>
                    <div class="rating-options">
                        <label class="rating-option negative-strong">
                            <input type="radio" name="rating" value="-2" aria-describedby="rating-desc-neg2">
                            <span class="rating-button">-2</span>
                            <span class="rating-label">Strongly rejected</span>
                            <span id="rating-desc-neg2" class="sr-only">Rating -2, strongly rejected</span>
                        </label>
                        <label class="rating-option negative">
                            <input type="radio" name="rating" value="-1" aria-describedby="rating-desc-neg1">
                            <span class="rating-button">-1</span>
                            <span class="rating-label">Rejected</span>
                            <span id="rating-desc-neg1" class="sr-only">Rating -1, rejected</span>
                        </label>
                        <label class="rating-option neutral">
                            <input type="radio" name="rating" value="0" aria-describedby="rating-desc-neutral">
                            <span class="rating-button">0</span>
                            <span class="rating-label">Neutral</span>
                            <span id="rating-desc-neutral" class="sr-only">Notation 0, neutre</span>
                        </label>
                        <label class="rating-option positive">
                            <input type="radio" name="rating" value="1" aria-describedby="rating-desc-pos1">
                            <span class="rating-button">+1</span>
                            <span class="rating-label">Accepted</span>
                            <span id="rating-desc-pos1" class="sr-only">Rating +1, accepted</span>
                        </label>
                        <label class="rating-option positive-strong">
                            <input type="radio" name="rating" value="2" aria-describedby="rating-desc-pos2">
                            <span class="rating-button">+2</span>
                            <span class="rating-label">Strongly accepted</span>
                            <span id="rating-desc-pos2" class="sr-only">Rating +2, strongly accepted</span>
                        </label>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="navigation" aria-label="Vote navigation">
                    <button id="prev-btn" class="btn btn-secondary" disabled>
                        Previous
                    </button>
                    <button id="next-btn" class="btn btn-primary" disabled>
                        Next
                    </button>
                </nav>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="review-screen" class="screen" role="main" aria-labelledby="review-title">
            <h2 id="review-title">Review Your Ratings</h2>
            <p class="review-instructions">Review your ratings below. Click on an option to modify your rating.</p>

            <div id="review-grid" class="review-grid" role="grid" aria-label="Ratings review grid"></div>

            <div class="review-actions">
                <!-- CAPTCHA Section -->
                <div id="captcha-container" class="captcha-container">
                    <div class="captcha-label">Security Check</div>
                    <div id="captcha-widget" class="captcha-widget"></div>
                    <div id="captcha-error" class="field-error" style="display: none;" role="alert"></div>
                </div>

                <button id="back-to-voting" class="btn btn-secondary">
                    Modify Ratings
                </button>
                <button id="submit-vote" class="btn btn-primary" disabled>
                    Confirm and Submit
                </button>
            </div>
        </div>

        <!-- Success Screen -->
        <div id="success-screen" class="screen" role="main" aria-labelledby="success-title">
            <div class="success-content">
                <div class="success-icon" aria-hidden="true">‚úÖ</div>
                <h2 id="success-title">Thank you for your participation!</h2>
                <p id="success-message">Your vote has been recorded successfully.</p>
                <div class="success-actions">
                    <button id="new-vote-btn" class="btn btn-primary" data-action="new-vote">
                        New Vote
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Live region for screen reader announcements -->
    <div id="live-region" class="sr-only" aria-live="polite" aria-atomic="true"></div>

    <!-- Vote data (passed from backend) -->
    <script type="application/json" id="vote-data">{{ vote_json|safe }}</script>

    <script src="/static/js/event-handlers.js" defer></script>
    <script src="/static/public_vote.js"></script>
</body>
</html>
